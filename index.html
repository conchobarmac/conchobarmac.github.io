<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Google Map with GeoJSON Polygon</title>
    <!-- Replace YOUR_API_KEY with your actual API key -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBX_I71Gwb4In2KPQPQhlJ9bzaFFsw7ITQ"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      #map {
        width: 100%;
        height: 100%;
      }
    </style>
    <script>
      function initMap() {
        // 1. Grab the 'geojson' param from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const geojsonParam = urlParams.get('geojson');
        
        if (!geojsonParam) {
          console.warn('No geojson param provided. Using a default center.');
          const map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 37.77, lng: -122.41 },
            zoom: 8,
            mapTypeId: 'satellite'
          });
          return;
        }

        // 2. Parse the JSON
        let geojson;
        try {
          geojson = JSON.parse(geojsonParam);
        } catch (e) {
          console.error('Error parsing geojson:', e);
          // Fallback map if parsing fails
          const map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: 37.77, lng: -122.41 },
            zoom: 8,
            mapTypeId: 'satellite'
          });
          return;
        }
        
        // 3. Extract the polygon coordinates
        //    Let's assume it's a Feature with a Polygon geometry.
        //    GeoJSON polygon coordinates are typically: geometry.coordinates = [ [ [lng, lat], [lng, lat], ... ] ]
        //    We'll only handle the outer ring here. For multiple rings or multi-polygons, you'll need extra logic.
        
        // If it's a FeatureCollection, pick the first feature:
        if (geojson.type === "FeatureCollection") {
          // for safety, just pick the first feature
          geojson = geojson.features[0]; 
        }

        // If it's a Feature, dig into the geometry:
        let geometry;
        if (geojson.type === "Feature") {
          geometry = geojson.geometry;
        } else if (geojson.type === "Polygon") {
          // it's directly a geometry
          geometry = geojson;
        } else {
          console.error("Unsupported GeoJSON type:", geojson.type);
          return;
        }

        if (geometry.type !== "Polygon" && geometry.type !== "MultiPolygon") {
          console.error("GeoJSON geometry is not a Polygon or MultiPolygon. Found:", geometry.type);
          return;
        }

        const map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 0, lng: 0 },
          zoom: 3,
          mapTypeId: 'satellite'
        });

        // A helper function to convert a single ring from [lng, lat] to google's {lat, lng} format:
        function ringToLatLng(ringCoords) {
          return ringCoords.map(coord => {
            const [lng, lat] = coord;
            return { lat: lat, lng: lng };
          });
        }

        // Function to draw a polygon ring on the map
        function drawPolygon(paths) {
          const polygon = new google.maps.Polygon({
            paths: paths,
            strokeColor: '#FF0000',
            fillColor: '#FF0000',
            fillOpacity: 0.05,
            strokeWeight: 2,
            map: map
          });
          return polygon;
        }

        // For a standard "Polygon" geometry, geometry.coordinates is an array of "rings"
        // (the first ring is the outer boundary, subsequent rings are holes, etc.)
        // For "MultiPolygon", geometry.coordinates is an array of polygons -> each polygon is an array of rings.
        let polygons = [];

        if (geometry.type === "Polygon") {
          polygons.push(geometry.coordinates);
        } else if (geometry.type === "MultiPolygon") {
          polygons = geometry.coordinates; // each item is an array of rings
        }

        const bounds = new google.maps.LatLngBounds();

        polygons.forEach(rings => {
          // rings is an array of ring, e.g. [ [lng, lat], [lng, lat], ... ] for the outer ring,
          // plus optional inner rings for holes.
          // The first ring is the outer boundary
          const outerRingLatLng = ringToLatLng(rings[0]);
          // If you want to handle holes, you can also convert rings[1], rings[2], etc.

          // Draw the polygon from the outer ring (and holes if you want)
          const polygonObj = drawPolygon(outerRingLatLng);

          // Extend the bounds by all coords in the outer ring
          outerRingLatLng.forEach(coord => bounds.extend(coord));
        });

        map.fitBounds(bounds);
      }
    </script>
  </head>
  <body onload="initMap()">
    <div id="map"></div>
  </body>
</html>

